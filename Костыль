compare_ips_based_on_subnet_mask() {
  local ip1="$1"
  local ip2="$2"
  local subnet_mask="$3"

  # Проверка валидности маски сети
  if ! validate_subnet_mask "$subnet_mask"; then
    echo "Неправильная маска сети: $subnet_mask" >&2
    return 1
  fi

  # Разделение маски сети на октеты
  IFS='.' read -ra mask_octets <<< "$subnet_mask"

  local octets_to_compare=()  # Октеты для сравнения

  # Определение октетов для сравнения на основе маски сети
  for ((i = 0; i < 4; i++)); do
    local mask_octet="${mask_octets[$i]}"
    if [ "$mask_octet" -eq 255 ]; then
      octets_to_compare+=($i)
    else
      break  # Как только встречен октет, отличный от 255, выходим из цикла
    fi
  done

  # Сравнение октетов IP-адресов
  for octet_index in "${octets_to_compare[@]}"; do
    local ip1_octet="${ip1_octets[$octet_index]}"
    local ip2_octet="${ip2_octets[$octet_index]}"

    if [ "$ip1_octet" -gt "$ip2_octet" ]; then
      return 0  # Первый IP больше
    elif [ "$ip1_octet" -lt "$ip2_octet" ]; then
      return 1  # Второй IP больше
    fi
  done

  return 2  # Октеты для сравнения идентичны
}
